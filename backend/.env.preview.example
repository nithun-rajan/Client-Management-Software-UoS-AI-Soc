# Estate Agent CRM - Preview Environment Configuration
# This file contains environment variables for preview deployments
# These are automatically configured by Railway/Vercel

# =============================================================================
# Application Settings
# =============================================================================

# Preview environments are always set to 'preview'
ENVIRONMENT=preview

# Log level for preview environments
LOG_LEVEL=INFO

# Disable debug mode in preview for security
DEBUG=false

# =============================================================================
# Database Configuration
# =============================================================================

# Railway automatically provides DATABASE_URL via PostgreSQL plugin
# This will be in the format: postgresql://user:password@host:port/dbname
# DATABASE_URL is automatically injected by Railway

# Alternative: Use SQLite for lightweight previews (not recommended for shared testing)
# DATABASE_URL=sqlite:///./preview_crm.db

# =============================================================================
# API Configuration
# =============================================================================

# Railway provides PORT automatically
# API_PORT will be read from $PORT environment variable

# CORS origins - include your Vercel preview URL pattern
# Format: https://your-project-*.vercel.app
CORS_ORIGINS=https://estate-agent-crm-frontend-*.vercel.app,http://localhost:5173

# =============================================================================
# Security Settings
# =============================================================================

# ⚠️  SECRET_KEY should be set via Railway/Vercel secrets dashboard
# Each preview environment can share a preview-specific secret
# SECRET_KEY is injected via platform secrets

# Shorter token expiration for preview environments
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Use strict CSP in preview to match production behavior
CSP_MODE=strict

# =============================================================================
# Rate Limiting Configuration
# =============================================================================

# More lenient rate limits for testing in preview
RATE_LIMIT_DEFAULT=1000/minute

# Use memory storage for preview (no Redis required)
# For production-like testing, configure Redis plugin in Railway
RATE_LIMIT_STORAGE_URI=memory://

# =============================================================================
# Observability & Monitoring
# =============================================================================

# Enable metrics in preview to test observability features
ENABLE_METRICS=true

# Enable structured logging for better debugging
ENABLE_JSON_LOGGING=true

REQUEST_ID_HEADER=X-Request-ID

# =============================================================================
# SLO & Error Budget Configuration
# =============================================================================

# Preview environment SLO targets (more relaxed)
SLO_UPTIME_TARGET=0.95
SLO_LATENCY_P95_MS=1000
SLO_ERROR_RATE_TARGET=0.01
ERROR_BUDGET_PERIOD_DAYS=7

# =============================================================================
# Preview-Specific Settings
# =============================================================================

# Identify this as a preview environment in logs
IS_PREVIEW_ENV=true

# Preview environment identifier (e.g., pr-123)
# PREVIEW_ENV_ID is automatically set by the deployment workflow
# PREVIEW_ENV_ID=pr-$PR_NUMBER

# Preview deployment URL (automatically set by Railway)
# RAILWAY_PUBLIC_DOMAIN or RAILWAY_STATIC_URL

# =============================================================================
# External Services (Disabled or Sandboxed for Preview)
# =============================================================================

# Use sandbox/test credentials for external services in preview
# SENDGRID_API_KEY should be a test key if emails are needed
# For most previews, disable email sending entirely

# AWS S3 - use a preview bucket or disable file uploads
# AWS_S3_BUCKET=preview-uploads-bucket

# =============================================================================
# Development & Testing Features
# =============================================================================

# Disable hot reload in preview (not applicable)
RELOAD=false

# Force HTTPS in preview environments (Railway handles SSL)
FORCE_HTTPS=true

# =============================================================================
# Database Seeding (Optional)
# =============================================================================

# Enable automatic database seeding for preview environments
# Useful for having test data in each preview
ENABLE_DB_SEED=true

# Seed data preset (e.g., minimal, full, demo)
SEED_PRESET=minimal

# =============================================================================
# Resource Limits
# =============================================================================

# Limit database connections for preview (smaller instance)
DB_POOL_SIZE=5
DB_MAX_OVERFLOW=10

# Worker configuration (single worker for preview to save resources)
WEB_CONCURRENCY=1
WORKERS=1
