# Gitleaks Configuration
# https://github.com/gitleaks/gitleaks

title = "Estate Agent CRM - Gitleaks Configuration"

# Extend default rules
[extend]
useDefault = true

# Custom rules specific to this project
[[rules]]
id = "railway-token"
description = "Railway API Token"
regex = '''railway_[a-zA-Z0-9]{32,}'''
keywords = ["railway_"]

[[rules]]
id = "vercel-token"
description = "Vercel API Token"
regex = '''vercel_[a-zA-Z0-9]{32,}'''
keywords = ["vercel_"]

[[rules]]
id = "fastapi-secret-key"
description = "FastAPI Secret Key"
regex = '''SECRET_KEY\s*=\s*['"][a-f0-9]{64}['"]'''
keywords = ["SECRET_KEY"]

[[rules]]
id = "database-url-with-password"
description = "Database URL with embedded password"
regex = '''(?i)(postgresql|mysql|mongodb):\/\/[^:]+:[^@]+@[^\/]+'''
keywords = ["postgresql://", "mysql://", "mongodb://"]

[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_-]*\.eyJ[a-zA-Z0-9_-]*\.[a-zA-Z0-9_-]*'''
keywords = ["eyJ"]

[[rules]]
id = "sendgrid-api-key"
description = "SendGrid API Key"
regex = '''SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}'''
keywords = ["SG."]

[[rules]]
id = "stripe-api-key"
description = "Stripe API Key"
regex = '''(sk|pk)_(test|live)_[a-zA-Z0-9]{24,}'''
keywords = ["sk_test_", "pk_test_", "sk_live_", "pk_live_"]

# Allowlist for false positives
[allowlist]
description = "Allowlisted files and patterns"
paths = [
  '''.env.example$''',
  '''.env.*.example$''',
  '''.env.template$''',
  '''\.md$''',  # Markdown files often contain example secrets
  '''test.*\.py$''',  # Test files may contain mock secrets
  '''.*_test\.py$''',
  '''tests/.*\.py$''',
  '''.secrets.baseline$''',
  '''.gitleaks.toml$''',
  '''package-lock.json$''',
  '''bun.lockb$''',
]

# Patterns that are safe to ignore
regexes = [
  '''your-secret-key-here''',
  '''replace-in-production''',
  '''example-api-key''',
  '''test-secret-key''',
  '''fake-token-for-testing''',
  '''mock-[a-z-]+''',
  '''dummy-[a-z-]+''',
  '''sample-[a-z-]+''',
  '''default-secret-key-change-in-production''',
]

# Keywords that are safe in certain contexts
[[allowlist.regexTarget]]
regex = '''(?i)SECRET_KEY.*your-secret-key-here'''
description = "Example secret key placeholder"

[[allowlist.regexTarget]]
regex = '''(?i)DATABASE_URL.*sqlite:///'''
description = "SQLite URLs don't contain credentials"

[[allowlist.regexTarget]]
regex = '''(?i)(test|example|sample|demo|fake|mock|dummy)'''
description = "Test/example data"

[[allowlist.regexTarget]]
regex = '''(?i)default_secret\s*=\s*["']default-secret-key-change-in-production["']'''
description = "Security validation code checking for default secrets"

[[allowlist.regexTarget]]
regex = '''(?i)SECRET_KEY.*default-secret-key-change-in-production'''
description = "Default fallback value for SECRET_KEY in development"
