

# Check for .env files being committed (but allow .env.example and .env.*.example)
if git diff --cached --name-only | grep -E '\.env$|\.env\..*$' | grep -v '\.example$'; then
  echo "❌ Error: Attempting to commit .env file(s)!"
  echo "   .env files contain secrets and should never be committed."
  echo "   Please unstage them with: git reset HEAD <file>"
  exit 1
fi

# Check for common secret patterns in staged changes
if git diff --cached -G'(password|api_key|secret|token|private_key)' | grep -iE '(password|api_key|secret|token|private_key)\s*[:=]'; then
  echo "⚠️  Warning: Potential secret detected in staged changes!"
  echo "   Found patterns matching: password, api_key, secret, token, private_key"
  echo "   Please review your changes carefully."
  echo ""
  read -p "   Continue with commit anyway? (y/N) " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
fi

echo "✅ Pre-commit checks passed"
